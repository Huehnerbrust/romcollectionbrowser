CREATE TABLE IF NOT EXISTS [Company]
(
    [id] INTEGER PRIMARY KEY AUTOINCREMENT,
    [name] TEXT NOT NULL UNIQUE,
    [description] TEXT,
    [street] TEXT,
    [city] TEXT,
    [country] TEXT,
    [state] TEXT,
    [phone] TEXT,
    [webSite] TEXT,
    [yearId] INTEGER REFERENCES [Year]
    (
        id
    )
);


CREATE TABLE IF NOT EXISTS [PersonRole]
(
    [id] INTEGER PRIMARY KEY AUTOINCREMENT,
    [name] TEXT NOT NULL UNIQUE
);


CREATE TABLE IF NOT EXISTS [Person]
(
    [id] INTEGER PRIMARY KEY AUTOINCREMENT,
    [name] TEXT NOT NULL UNIQUE,
    [description] TEXT,
    [country] TEXT,
    [city] TEXT,
    [gender] INTEGER,
    [birthdate] DATE,
    [deathdate] DATE
);


CREATE TABLE IF NOT EXISTS [Genre]
(
    [id] INTEGER PRIMARY KEY AUTOINCREMENT,
    [name] TEXT NOT NULL UNIQUE,
    [description] TEXT
);


CREATE TABLE IF NOT EXISTS [Character]
(
    [id] INTEGER PRIMARY KEY AUTOINCREMENT,
    [name] TEXT NOT NULL UNIQUE,
    [description] TEXT,
    [gender] INTEGER,
    [realName] TEXT
);


CREATE TABLE IF NOT EXISTS [Region] 
(
    [id] INTEGER PRIMARY KEY AUTOINCREMENT,
    [name] TEXT NOT NULL UNIQUE,
    [description] TEXT
);


CREATE TABLE IF NOT EXISTS [Perspective]
(
    [id] INTEGER PRIMARY KEY AUTOINCREMENT,
    [name] TEXT NOT NULL UNIQUE,
    [description] TEXT
);


CREATE TABLE IF NOT EXISTS [Controller]
(
    [id] INTEGER PRIMARY KEY AUTOINCREMENT,
    [name] TEXT NOT NULL UNIQUE,
    [description] TEXT
);


CREATE TABLE IF NOT EXISTS [Media]
(
    [id] INTEGER PRIMARY KEY AUTOINCREMENT,
    [name] TEXT NOT NULL UNIQUE,
    [description] TEXT
);


CREATE TABLE IF NOT EXISTS [Language]
(
    [id] INTEGER PRIMARY KEY AUTOINCREMENT,
    [name] TEXT NOT NULL UNIQUE
);


CREATE TABLE IF NOT EXISTS [MaxPlayers]
(
    [id] INTEGER PRIMARY KEY AUTOINCREMENT,
    [name] TEXT NOT NULL UNIQUE
);


CREATE TABLE IF NOT EXISTS [Year] 
(
    [id] INTEGER PRIMARY KEY AUTOINCREMENT,
    [name] TEXT NOT NULL UNIQUE
);


CREATE TABLE IF NOT EXISTS [RomCollection]
(
    [id] INTEGER PRIMARY KEY AUTOINCREMENT,
    [name] TEXT NOT NULL UNIQUE
);


CREATE TABLE IF NOT EXISTS [Platform]
(
    [id] INTEGER PRIMARY KEY AUTOINCREMENT,
    [name] TEXT NOT NULL UNIQUE,
    [description] TEXT,
    [releaseYear] TEXT,
    [developerId] INTEGER REFERENCES [Company]
    (
        id
    ),
    [manufacturerId] INTEGER REFERENCES [Company]
    (
        id
    ),
    [cpu] TEXT,
    [ram] TEXT,
    [graphics] TEXT,
    [sound] TEXT,
    [display] TEXT,
    [maxControllers] INTEGER,
    [soldUnits] INTEGER,
    [hasOnlineFeatures] INTEGER,
    [originalPrice] INTEGER
);


CREATE TABLE IF NOT EXISTS [Game]
(
    [id] INTEGER PRIMARY KEY AUTOINCREMENT,
    [name] TEXT NOT NULL UNIQUE
);


CREATE TABLE IF NOT EXISTS [Release]
(
    [id] INTEGER PRIMARY KEY AUTOINCREMENT,
    [name] TEXT NOT NULL,
    [description] TEXT,
    [gameCmd] TEXT,
    [alternateGameCmd] TEXT,
    [isFavorite] INTEGER,
    [launchCount] INTEGER,
    [version] TEXT,
    [completed] INTEGER,
    [broken] INTEGER,
    [dateAdded] DATE,
    [dateModified] DATE,
    [lastPlayed] DATE,
    [gameId] INTEGER NOT NULL REFERENCES [Game]
    (
        id
    ),
    [platformId] INTEGER NOT NULL REFERENCES [Platform]
    (
        id
    ),
    [romCollectionId] INTEGER REFERENCES [RomCollection]
    (
        id
    ),
    [developerId] INTEGER REFERENCES [Company]
    (
        id
    ),
    [publisherId] INTEGER REFERENCES [Company]
    (
        id
    ),
    [yearId] INTEGER REFERENCES [Year]
    (
        id
    ),
    [regionId] INTEGER REFERENCES [Region]
    (
        id
    ),
    [languageId] INTEGER REFERENCES [Language]
    (
        id
    ),
    [maxPlayersId] INTEGER REFERENCES [MaxPlayers]
    (
        id
    ),
    [perspectiveId] INTEGER REFERENCES [Perspective]
    (
        id
    ),
    [nameFromFile] TEXT,
    [firstRomFile] TEXT
);


CREATE TABLE IF NOT EXISTS [AlternateTitle] 
(
    [id] INTEGER PRIMARY KEY AUTOINCREMENT,
    [name] TEXT NOT NULL UNIQUE,
    [releaseId] INTEGER REFERENCES [Release]
    (
        id
    )
);


CREATE TABLE IF NOT EXISTS [LinkReleasePersonRole]
(
    [id] INTEGER PRIMARY KEY AUTOINCREMENT,
    [releaseId] INTEGER REFERENCES [Release]
    (
        id
    ),
    [personId] INTEGER REFERENCES [Person]
    (
        id
    ),
    [roleId] INTEGER REFERENCES [PersonRole]
    (
        id
    )
);


CREATE TABLE IF NOT EXISTS [LinkGenreGame]
(
    [id] INTEGER PRIMARY KEY AUTOINCREMENT,
    [genreId] INTEGER REFERENCES [Genre]
    (
        id
    ),
    [gameId] INTEGER REFERENCES [Game]
    (
        id
    )
);


CREATE TABLE IF NOT EXISTS [LinkCharacterRelease]
(
    [id] INTEGER PRIMARY KEY AUTOINCREMENT,
    [characterId] INTEGER REFERENCES [Character]
    (
        id
    ),
    [releaseId] INTEGER REFERENCES [Release]
    (
        id
    )
);


CREATE TABLE IF NOT EXISTS [LinkMediaRelease]
(
    [id] INTEGER PRIMARY KEY AUTOINCREMENT,
    [mediaId] INTEGER REFERENCES [Media]
    (
        id
    ),
    [releaseId] INTEGER REFERENCES [Release]
    (
        id
    )
);


CREATE TABLE IF NOT EXISTS [LinkControllerRelease]
(
    [id] INTEGER PRIMARY KEY AUTOINCREMENT,
    [controllerId] INTEGER REFERENCES [Controller]
    (
        id
    ),
    [releaseId] INTEGER REFERENCES [Release]
    (
        id
    )
);


CREATE TABLE IF NOT EXISTS [LinkMediaPlatform]
(
    [id] INTEGER PRIMARY KEY AUTOINCREMENT,
    [mediaId] INTEGER REFERENCES [Media]
    (
        id
    ),
    [platformId] INTEGER REFERENCES [Platform]
    (
        id
    )
);


CREATE TABLE IF NOT EXISTS [LinkControllerPlatform]
(
    [id] INTEGER PRIMARY KEY AUTOINCREMENT,
    [controllerId] INTEGER REFERENCES [Controller]
    (
        id
    ),
    [platformId] INTEGER REFERENCES [Platform]
    (
        id
    )
);


CREATE TABLE IF NOT EXISTS [RatingBoard]
(
    [id] INTEGER PRIMARY KEY AUTOINCREMENT,
    [name] TEXT NOT NULL UNIQUE
);


CREATE TABLE IF NOT EXISTS [AgeRating]
(
    [id] INTEGER PRIMARY KEY AUTOINCREMENT,
    [name] TEXT NOT NULL UNIQUE,
    [boardId] INTEGER REFERENCES [RatingBoard]
    (
        id
    ),
    [releaseId] INTEGER REFERENCES [Release]
    (
        id
    )
);


CREATE TABLE IF NOT EXISTS [ScraperSource]
(
    [id] INTEGER PRIMARY KEY AUTOINCREMENT,
    [name] TEXT NOT NULL UNIQUE,
    [url] TEXT
);


CREATE TABLE IF NOT EXISTS [ScraperRating]
(
    [id] INTEGER PRIMARY KEY AUTOINCREMENT,
    [name] TEXT NOT NULL UNIQUE,
    [sourceId] INTEGER REFERENCES [ScraperSource]
    (
        id
    ),
    [ratingMax] INTEGER
);


CREATE TABLE IF NOT EXISTS [UserRating]
(
    [id] INTEGER PRIMARY KEY AUTOINCREMENT,
    [name] TEXT NOT NULL,
    [numVotes] INTEGER,
    [ratingId] INTEGER REFERENCES [ScraperRating]
    (
        id
    ),
    [parentType] TEXT NOT NULL,
    [parentId] INTEGER NOT NULL
);


CREATE TABLE IF NOT EXISTS [FileType]
(
    [id] INTEGER PRIMARY KEY AUTOINCREMENT,
    [name] TEXT NOT NULL UNIQUE
);


CREATE TABLE IF NOT EXISTS [File] 
(
    [id] INTEGER PRIMARY KEY AUTOINCREMENT,
    [name] TEXT NOT NULL,
    [fileTypeId]  INTEGER REFERENCES [FileType]
    (
        id
    ),
    [parentId] INTEGER NOT NULL
);


CREATE TABLE IF NOT EXISTS [DetailUrl] 
(
    [id] INTEGER PRIMARY KEY AUTOINCREMENT,
    [name] TEXT NOT NULL UNIQUE,
    [urlType] TEXT NOT NULL,
    [source] TEXT NOT NULL,
    [parentType] TEXT NOT NULL,
    [parentId] INTEGER NOT NULL
);


CREATE TABLE IF NOT EXISTS [RCBSetting]
(
    [id] INTEGER PRIMARY KEY AUTOINCREMENT,
    [lastSelectedView] TEXT,
    [lastSelectedPlatformIndex] INTEGER,    
    [lastSelectedGenreIndex] INTEGER,
    [lastSelectedPublisherIndex] INTEGER,
    [lastSelectedYearIndex] INTEGER,
    [lastSelectedGameIndex] INTEGER,    
    [autoexecBackupPath] TEXT,
    [dbVersion] TEXT,    
    [lastFocusedControlMainView] INTEGER,
    [lastFocusedControlGameInfoView] INTEGER,    
    [lastSelectedCharacterIndex] INTEGER    
);


CREATE VIEW ReleaseView AS
       SELECT R.id,
              R.name,
              R.description,
              R.gameCmd,
              R.alternateGameCmd,
              R.isFavorite,
              R.launchCount,
              R.version,
              R.completed,
              R.broken,
              R.dateAdded,
              R.dateModified,
              R.lastPlayed,
              R.nameFromFile,
              R.firstRomFile,
              R.gameId,
              R.platformId,
              Platform.name AS platform,
              R.developerId,
              Developer.name AS developer,
              R.publisherId,
              Publisher.name AS publisher,
              R.romCollectionId,
              RomCollection.name AS romCollection,
              R.yearId,
              Year.name AS year,
              R.regionId,
              Region.name AS region,
              R.languageId,
              Language.name AS language,
              R.maxPlayersId,
              MaxPlayers.name AS maxPlayers,
              R.perspectiveId,
              Perspective.name AS perspective
         FROM [RELEASE] R
              LEFT OUTER JOIN Platform
                           ON R.platformId = Platform.id
              LEFT OUTER JOIN Company Developer
                           ON R.developerId = Developer.id
              LEFT OUTER JOIN Company Publisher
                           ON R.publisherId = Publisher.id
              LEFT OUTER JOIN RomCollection
                           ON R.romCollectionId = RomCollection.id
              LEFT OUTER JOIN Year
                           ON R.yearId = Year.id
              LEFT OUTER JOIN Region
                           ON R.regionId = Region.id
              LEFT OUTER JOIN Language
                           ON R.languageId = Language.id
              LEFT OUTER JOIN MaxPlayers
                           ON R.maxPlayersId = MaxPlayers.id
              LEFT OUTER JOIN Perspective
                           ON R.perspectiveId = Perspective.id;
